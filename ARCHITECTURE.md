# é¡¹ç›®æ¶æ„æ€»è§ˆ

## æ–‡ä»¶ç»“æ„

```
IOS_emoji_analyser/
â”‚
â”œâ”€â”€ ğŸ“± App Entry
â”‚   â”œâ”€â”€ IOS_emoji_analyserApp.swift      # åº”ç”¨å…¥å£
â”‚   â””â”€â”€ ContentView.swift                 # ä¸»è§†å›¾æ§åˆ¶å™¨
â”‚
â”œâ”€â”€ ğŸ“Š Models (æ•°æ®æ¨¡å‹)
â”‚   â”œâ”€â”€ EmotionType.swift                 # 8ç§æƒ…ç»ªç±»å‹å®šä¹‰
â”‚   â””â”€â”€ EmojiMapper.swift                 # æƒ…ç»ªâ†’Emojiæ˜ å°„é€»è¾‘
â”‚
â”œâ”€â”€ ğŸ¨ Views (ç”¨æˆ·ç•Œé¢)
â”‚   â”œâ”€â”€ PermissionView.swift              # æƒé™è¯·æ±‚ç•Œé¢
â”‚   â”œâ”€â”€ EmojiDisplayView.swift            # ä¸»æ˜¾ç¤ºç•Œé¢ï¼ˆemoji + æ§åˆ¶ï¼‰
â”‚   â””â”€â”€ SettingsView.swift                # è®¾ç½®ã€å¸®åŠ©ã€å…³äºé¡µé¢
â”‚
â”œâ”€â”€ ğŸ§  ViewModels (ä¸šåŠ¡é€»è¾‘)
â”‚   â””â”€â”€ EmotionViewModel.swift            # åº”ç”¨çŠ¶æ€ç®¡ç†
â”‚       â”œâ”€â”€ æƒ…ç»ªçŠ¶æ€ç®¡ç†
â”‚       â”œâ”€â”€ ç›‘å¬æ§åˆ¶
â”‚       â”œâ”€â”€ å†å²è®°å½•ç®¡ç†
â”‚       â””â”€â”€ æƒé™ç®¡ç†é›†æˆ
â”‚
â”œâ”€â”€ âš™ï¸ Utilities (å·¥å…·ç±»)
â”‚   â”œâ”€â”€ PermissionManager.swift           # æƒé™ç®¡ç†å™¨
â”‚   â”‚   â”œâ”€â”€ éº¦å…‹é£æƒé™
â”‚   â”‚   â””â”€â”€ è¯­éŸ³è¯†åˆ«æƒé™
â”‚   â””â”€â”€ Constants.swift                   # åº”ç”¨å¸¸é‡
â”‚
â”œâ”€â”€ ğŸ”§ Services (å¾…å¼€å‘)
â”‚   â”œâ”€â”€ AudioCaptureService.swift         # [Phase 2] éŸ³é¢‘é‡‡é›†
â”‚   â”œâ”€â”€ SpeechRecognitionService.swift    # [Phase 2] è¯­éŸ³è¯†åˆ«
â”‚   â””â”€â”€ EmotionAnalysisService.swift      # [Phase 3] æƒ…ç»ªåˆ†æ
â”‚
â””â”€â”€ ğŸ“‹ Configuration
    â””â”€â”€ Info.plist                        # æƒé™é…ç½®
```

## æ•°æ®æµç¨‹å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ç”¨æˆ·å¯åŠ¨åº”ç”¨                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ContentView (ä¸»æ§åˆ¶å™¨)                    â”‚
â”‚                 æ£€æŸ¥æƒé™çŠ¶æ€ (onAppear)                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â†“                   â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  æƒé™æœªæˆäºˆ       â”‚   â”‚   æƒé™å·²æˆäºˆ      â”‚
        â”‚  PermissionView  â”‚   â”‚ EmojiDisplayView â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“                   â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  è¯·æ±‚æƒé™æŒ‰é’®     â”‚   â”‚   å¼€å§‹ç›‘å¬æŒ‰é’®   â”‚
        â”‚  â†’ æˆæƒååˆ·æ–°    â”‚   â”‚   â†“              â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  [Phase 2]       â”‚
                               â”‚  éŸ³é¢‘é‡‡é›† â†’      â”‚
                               â”‚  è¯­éŸ³è¯†åˆ« â†’      â”‚
                               â”‚  [Phase 3]       â”‚
                               â”‚  æƒ…ç»ªåˆ†æ â†’      â”‚
                               â”‚  Emojiæ˜¾ç¤º       â”‚
                               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ç»„ä»¶ä¾èµ–å…³ç³»

```
ContentView
    â†“
    â”œâ”€â†’ EmotionViewModel (StateObject)
    â”‚       â†“
    â”‚       â””â”€â†’ PermissionManager (ObservableObject)
    â”‚
    â”œâ”€â†’ PermissionView
    â”‚       â†“
    â”‚       â””â”€â†’ PermissionManager (è§‚å¯Ÿæƒé™çŠ¶æ€)
    â”‚
    â”œâ”€â†’ EmojiDisplayView
    â”‚       â†“
    â”‚       â”œâ”€â†’ EmotionViewModel (æ˜¾ç¤ºçŠ¶æ€)
    â”‚       â””â”€â†’ Constants (UIé…ç½®)
    â”‚
    â””â”€â†’ SettingsView
            â†“
            â”œâ”€â†’ HelpView
            â”œâ”€â†’ AboutView
            â””â”€â†’ Constants (ç‰ˆæœ¬ä¿¡æ¯)
```

## çŠ¶æ€ç®¡ç†

### EmotionViewModel (@Published å±æ€§)
```swift
@Published var currentEmotion: EmotionType      // å½“å‰æƒ…ç»ª
@Published var currentEmoji: String             // å½“å‰æ˜¾ç¤ºçš„emoji
@Published var recognizedText: String           // è¯†åˆ«çš„æ–‡æœ¬
@Published var isListening: Bool                // ç›‘å¬çŠ¶æ€
@Published var emotionHistory: [EmotionRecord]  // å†å²è®°å½•
```

### PermissionManager (@Published å±æ€§)
```swift
@Published var microphonePermissionGranted: Bool           // éº¦å…‹é£æƒé™
@Published var speechRecognitionPermissionGranted: Bool    // è¯­éŸ³è¯†åˆ«æƒé™
```

## å…³é”®åŠŸèƒ½å®ç°

### 1. æƒé™æ£€æŸ¥æµç¨‹
```
Appå¯åŠ¨ â†’ PermissionManager.init()
         â†’ checkPermissions()
         â†’ æ›´æ–° @Published çŠ¶æ€
         â†’ ContentView æ ¹æ®çŠ¶æ€åˆ‡æ¢è§†å›¾
```

### 2. æƒé™è¯·æ±‚æµç¨‹
```
ç”¨æˆ·ç‚¹å‡»"æˆäºˆæƒé™" â†’ requestAllPermissions()
                   â†’ requestMicrophonePermission()
                   â†’ requestSpeechRecognitionPermission()
                   â†’ ç³»ç»Ÿå¼¹çª—
                   â†’ ç”¨æˆ·æˆæƒ
                   â†’ æ›´æ–°çŠ¶æ€
                   â†’ UIè‡ªåŠ¨åˆ‡æ¢
```

### 3. Emojiæ˜¾ç¤ºæµç¨‹ï¼ˆå½“å‰ä¸ºæµ‹è¯•æ¨¡å¼ï¼‰
```
ç‚¹å‡»æµ‹è¯•æŒ‰é’® â†’ simulateEmotion()
            â†’ éšæœºé€‰æ‹©æƒ…ç»ª
            â†’ updateEmotion(emotion, text)
            â†’ æ›´æ–° currentEmoji
            â†’ æ·»åŠ åˆ° emotionHistory
            â†’ UIè‡ªåŠ¨æ›´æ–°ï¼ˆå¸¦åŠ¨ç”»ï¼‰
```

### 4. æœªæ¥å®ç°æµç¨‹ï¼ˆPhase 2 & 3ï¼‰
```
ç‚¹å‡»"å¼€å§‹ç›‘å¬" â†’ startListening()
              â†’ AudioCaptureService.start()
              â†’ å®æ—¶éŸ³é¢‘æµ
              â†’ SpeechRecognitionService.recognize()
              â†’ å®æ—¶æ–‡æœ¬
              â†’ EmotionAnalysisService.analyze()
              â†’ æƒ…ç»ªæ ‡ç­¾
              â†’ EmojiMapper.emotionType()
              â†’ updateEmotion()
              â†’ UIæ˜¾ç¤º
```

## UI ç»„ä»¶è¯´æ˜

### PermissionView
- æƒé™çŠ¶æ€æ˜¾ç¤ºå¡ç‰‡
- æˆäºˆæƒé™æŒ‰é’®
- å‰å¾€è®¾ç½®æŒ‰é’®
- ç²¾ç¾çš„å›¾æ ‡å’ŒåŠ¨ç”»

### EmojiDisplayView
- å¤§å°ºå¯¸emojiæ˜¾ç¤ºåŒºï¼ˆ120ptï¼‰
- æƒ…ç»ªåç§°æ ‡ç­¾
- è¯†åˆ«æ–‡æœ¬æ˜¾ç¤º
- å¼€å§‹/åœæ­¢æŒ‰é’®
- æµ‹è¯•æŒ‰é’®ï¼ˆå¼€å‘ç”¨ï¼‰
- å†å²è®°å½•åˆ—è¡¨

### SettingsView
- åº”ç”¨ä¿¡æ¯
- æƒé™ç®¡ç†å…¥å£
- ä½¿ç”¨è¯´æ˜
- å…³äºé¡¹ç›®
- å¼€å‘è€…ä¿¡æ¯

## åŠ¨ç”»æ•ˆæœ

1. **Emojiåˆ‡æ¢åŠ¨ç”»**: SpringåŠ¨ç”»ï¼ˆå¼¹ç°§æ•ˆæœï¼‰
2. **ç›‘å¬çŠ¶æ€åŠ¨ç”»**: è„‰å†²æ•ˆæœï¼ˆscaleå˜åŒ–ï¼‰
3. **è§†å›¾åˆ‡æ¢**: é»˜è®¤SwiftUIè½¬åœºåŠ¨ç”»

## å¸¸é‡é…ç½® (Constants.swift)

- `emojiSize`: 120pt
- `animationDuration`: 0.3s
- `maxHistoryCount`: 10æ¡
- `confidenceThreshold`: 0.6

## ä¸‹ä¸€æ­¥å¼€å‘é‡ç‚¹

### Phase 2: éŸ³é¢‘é‡‡é›†ä¸è¯­éŸ³è¯†åˆ«
- [ ] AudioCaptureService
- [ ] SpeechRecognitionService
- [ ] å®æ—¶éŸ³é¢‘æµå¤„ç†
- [ ] è¯­éŸ³è½¬æ–‡å­—å®ç°

### Phase 3: æƒ…ç»ªåˆ†æ
- [ ] å‡†å¤‡/è·å–Core MLæ¨¡å‹
- [ ] EmotionAnalysisService
- [ ] æ¨¡å‹é›†æˆå’Œä¼˜åŒ–

### Phase 4: UIä¼˜åŒ–
- [ ] æ›´ä¸°å¯Œçš„åŠ¨ç”»æ•ˆæœ
- [ ] è‡ªå®šä¹‰emojiæ ·å¼
- [ ] æ·±è‰²æ¨¡å¼é€‚é…
- [ ] iPadé€‚é…
